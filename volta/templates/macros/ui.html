{# volta/templates/macros/ui.html #}

{% macro accordion_section(title, body='') -%}
  {# Stable, safe element id from title #}
  {% set safe_id = 'acc-' ~ (title|string)|lower|replace(' ', '-') %}

  <div class="accordion-item">
    <h2 class="accordion-header" id="{{ safe_id }}-header">
      <button class="accordion-button collapsed" type="button"
              data-bs-toggle="collapse"
              data-bs-target="#{{ safe_id }}-collapse"
              aria-expanded="false"
              aria-controls="{{ safe_id }}-collapse">
        {{ title }}
      </button>
    </h2>

    <div id="{{ safe_id }}-collapse"
         class="accordion-collapse collapse"
         aria-labelledby="{{ safe_id }}-header">
      <div class="accordion-body">
        {# If used with {% call %}...{% endcall %}, render the inner block #}
        {% if caller is defined %}
          {{ caller() }}
        {% else %}
          {{ body | safe }}
        {% endif %}
      </div>
    </div>
  </div>
{%- endmacro %}

{% macro checkbox_list(col, values, selected=[], list_id=None, searchable=False, placeholder="Search") -%}
  {% if searchable %}
    <div class="mb-2">
      <input type="text" class="form-control filter-search-input"
             placeholder="{{ placeholder }}"
             {% if list_id %}data-filter-target="#{{ list_id }}"{% endif %}>
    </div>
  {% endif %}
  <div class="filter-wrap"
       data-filter-list
       data-filter-name="{{ col }}"
       data-initial-selected='{{ selected | tojson | safe }}'
       {% if list_id %}id="{{ list_id }}"{% endif %}>
    {% for v in values %}
      <label class="filter-item">
        <input type="checkbox" name="{{ col }}" value="{{ v }}"
               {% if v in selected %}checked{% endif %}>
        <span class="label-text">{{ v }}</span>
      </label>
    {% endfor %}
  </div>
{%- endmacro %}

{% macro stat_box(title, value) -%}
  <div class="col-6 col-md-4 col-xl-2">
    <div class="p-2 bg-light rounded">
      <div class="text-muted small">{{ title }}</div>
      <div class="fs-5 fw-semibold text-nowrap">{{ value }}</div>
    </div>
  </div>
{%- endmacro %}
